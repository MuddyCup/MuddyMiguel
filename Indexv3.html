<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tanboymiguel - palabreo god | Cover Art Studio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #ffffff;
            color: #000000;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .canvas-container {
            position: relative;
            width: 500px;
            height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #000;
            transition: border-color 0.3s;
        }
        .layer {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .settings {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        .download-btn {
            margin-top: 10px;
            padding: 10px;
            background-color: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .download-btn:hover {
            background-color: #444;
        }
        .dark-mode {
            background-color: #000;
            color: #fff;
        }
        .dark-mode .canvas-container {
            border-color: #fff;
        }
        .dark-mode .download-btn {
            background-color: #fff;
            color: #000;
        }
        .dark-mode .download-btn:hover {
            background-color: #bbb;
        }
        @media (max-width: 600px) {
            .container {
                flex-direction: column;
            }
            .settings {
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <h1>tanboymiguel - palabreo god | Cover Art Studio</h1>
    <div class="container">
        <div class="controls">
            <label>Background: <select id="backgroundSelect"></select></label>
            <label>Miguel: <select id="miguelSelect"></select></label>
            <label>Title: <select id="titleSelect"></select></label>
            <label>Lv: <select id="lvSelect"></select></label>
            <label>Shirt: <select id="shirtSelect"></select></label>
        </div>
        <div class="canvas-container">
            <img id="background" class="layer">
            <img id="miguel" class="layer">
            <img id="title" class="layer">
            <img id="lv" class="layer">
            <img id="shirt" class="layer">
        </div>
        <div class="settings">
            <label>Dark Mode <input type="checkbox" id="darkModeToggle"></label>
            <label>Mobile Mode <input type="checkbox" id="mobileModeToggle"></label>
        </div>
    </div>
    <button class="download-btn" onclick="downloadImage()">Download</button>
    <script>
        const layers = ['background', 'miguel', 'title', 'lv', 'shirt'];
        const darkModeToggle = document.getElementById('darkModeToggle');
        const mobileModeToggle = document.getElementById('mobileModeToggle');
        
        function loadOptions() {
            layers.forEach(layer => {
                fetch(`assets/${layer}/`)
                    .then(response => response.text())
                    .then(text => {
                        const parser = new DOMParser();
                        const htmlDoc = parser.parseFromString(text, 'text/html');
                        const options = Array.from(htmlDoc.querySelectorAll('a'))
                            .map(link => link.href.split('/').pop())
                            .filter(name => name.endsWith('.png'));
                        
                        const select = document.getElementById(`${layer}Select`);
                        options.forEach(option => {
                            let opt = document.createElement('option');
                            opt.value = option;
                            opt.innerText = option;
                            select.appendChild(opt);
                        });
                        
                        select.addEventListener('change', () => updateLayer(layer, select.value));
                    });
            });
        }
        
        function updateLayer(layer, file) {
            document.getElementById(layer).src = `assets/${layer}/${file}`;
        }
        
        function downloadImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 500;
            canvas.height = 500;
            const ctx = canvas.getContext('2d');
            let imagesLoaded = 0;
            let totalImages = layers.length;
            
            function drawImage(img, callback) {
                const image = new Image();
                image.crossOrigin = "anonymous";
                image.src = img.src;
                image.onload = () => {
                    ctx.drawImage(image, 0, 0, 500, 500);
                    callback();
                };
            }
            
            function checkCompletion() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    const link = document.createElement('a');
                    link.download = 'custom_album_cover.png';
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                }
            }
            
            layers.forEach(layer => {
                const img = document.getElementById(layer);
                if (img.src && img.src !== window.location.href) {
                    drawImage(img, checkCompletion);
                } else {
                    totalImages--;
                }
            });
        }
        
        darkModeToggle.addEventListener('change', () => {
            document.body.classList.toggle('dark-mode', darkModeToggle.checked);
        });
        
        loadOptions();
    </script>
</body>
</html>
